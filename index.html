<!DOCTYPE html><html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙÙ‚Ø§Øª</title>
<style>
  /* Ù†ÙØ³ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± */
  /* ... ØªÙ… Ø§Ù„Ø¥Ø¨Ù‚Ø§Ø¡ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª ÙƒÙ…Ø§ Ù‡ÙŠ ÙÙŠ ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø³Ø§Ø¨Ù‚ ... */
</style>
</head>
<body>  <h2>Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙÙ‚Ø§Øª</h2>  <form id="tradeForm">
    <label for="pair">Ø²ÙˆØ¬ Ø§Ù„ØªØ¯Ø§ÙˆÙ„:</label>
    <select id="pair" name="pair" required>
      <option value="EUR/USD">EUR/USD</option>
      <option value="XAU/USD">XAU/USD</option>
      <option value="BTC/USD">BTC/USD</option>
      <option value="USD/JPY">USD/JPY</option>
    </select><label for="type">Ù†ÙˆØ¹ Ø§Ù„ØµÙÙ‚Ø©:</label>
<select id="type" name="type" required>
  <option value="Ø´Ø±Ø§Ø¡">Ø´Ø±Ø§Ø¡</option>
  <option value="Ø¨ÙŠØ¹">Ø¨ÙŠØ¹</option>
</select>

<label for="entry">Ø³Ø¹Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„:</label>
<input type="number" step="0.0001" id="entry" name="entry" required />

<label for="sl">ÙˆÙ‚Ù Ø§Ù„Ø®Ø³Ø§Ø±Ø©:</label>
<input type="number" step="0.0001" id="sl" name="sl" required />

<label for="tp">Ø§Ù„Ù‡Ø¯Ù:</label>
<input type="number" step="0.0001" id="tp" name="tp" required />

<label for="image">ØµÙˆØ±Ø© Ø§Ù„ØµÙÙ‚Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
<input type="file" id="image" accept="image/*" />

<div class="checkbox-container">
  <input type="checkbox" id="conditionsCheck" />
  <label for="conditionsCheck">ØªÙ… ØªÙˆÙØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙˆØ·</label>
</div>

<button type="submit" id="addTradeBtn" disabled>Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙÙ‚Ø© Ù…Ø¤Ù‚ØªÙ‹Ø§</button>

  </form>  <table aria-label="Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ©">
    <thead>
      <tr>
        <th>#</th>
        <th>Ø§Ù„Ø²ÙˆØ¬</th>
        <th>Ø§Ù„Ù†ÙˆØ¹</th>
        <th>Ø¯Ø®ÙˆÙ„</th>
        <th>ÙˆÙ‚Ù</th>
        <th>Ù‡Ø¯Ù</th>
        <th>Ø£Ø±Ø´ÙØ©</th>
      </tr>
    </thead>
    <tbody id="pendingTradesBody">
      <!-- Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ© ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
    </tbody>
  </table>  <div id="fabButton" title="Ø³Ø¬Ù„ Ø§Ù„ØµÙÙ‚Ø§Øª" aria-label="Ø³Ø¬Ù„ Ø§Ù„ØµÙÙ‚Ø§Øª" role="button" tabindex="0">ğŸ“…</div><script>
  let pendingTrades = JSON.parse(sessionStorage.getItem('pendingTrades') || '[]');
  let savedTrades = JSON.parse(localStorage.getItem('trades') || '[]');

  const tbody = document.getElementById('pendingTradesBody');
  const form = document.getElementById('tradeForm');
  const imageInput = document.getElementById('image');
  const conditionsCheck = document.getElementById('conditionsCheck');
  const addTradeBtn = document.getElementById('addTradeBtn');
  const fabButton = document.getElementById('fabButton');

  conditionsCheck.addEventListener('change', () => {
    addTradeBtn.disabled = !conditionsCheck.checked;
  });

  function renderPendingTrades() {
    tbody.innerHTML = '';
    pendingTrades.forEach((trade, index) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${index + 1}</td>
        <td>${trade.pair}</td>
        <td>${trade.type}</td>
        <td>${trade.entry}</td>
        <td>${trade.sl}</td>
        <td>${trade.tp}</td>
        <td><span class="archiveIcon" title="Ø£Ø±Ø´ÙØ© Ø§Ù„ØµÙÙ‚Ø©" onclick="archiveTrade(${index})">âœ“</span></td>
      `;
      tbody.appendChild(tr);
    });
  }

  form.addEventListener('submit', e => {
    e.preventDefault();

    if (!conditionsCheck.checked) {
      alert("ÙŠØ¬Ø¨ ØªÙØ¹ÙŠÙ„ 'ØªÙ… ØªÙˆÙØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙˆØ·' Ù‚Ø¨Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙÙ‚Ø©.");
      return;
    }

    const file = imageInput.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(evt) {
        saveTrade(evt.target.result); // Base64 URL Ù„Ù„ØµÙˆØ±Ø©
      };
      reader.readAsDataURL(file);
    } else {
      saveTrade(null);
    }
  });

  function saveTrade(imageData) {
    const newTrade = {
      pair: form.pair.value,
      type: form.type.value,
      entry: form.entry.value,
      sl: form.sl.value,
      tp: form.tp.value,
      timestamp: new Date().toISOString(),
      result: 'Ø¬Ø§Ø±ÙŠØ©',
      image: imageData // Base64 or null
    };

    pendingTrades.push(newTrade);
    sessionStorage.setItem('pendingTrades', JSON.stringify(pendingTrades));

    renderPendingTrades();
    form.reset();
    addTradeBtn.disabled = true;
    conditionsCheck.checked = false;
  }

  function archiveTrade(index) {
    const trade = pendingTrades[index];
    savedTrades.push(trade);
    pendingTrades.splice(index, 1);

    sessionStorage.setItem('pendingTrades', JSON.stringify(pendingTrades));
    localStorage.setItem('trades', JSON.stringify(savedTrades));

    renderPendingTrades();
    alert('ØªÙ… Ø£Ø±Ø´ÙØ© Ø§Ù„ØµÙÙ‚Ø© Ø¨Ù†Ø¬Ø§Ø­.');
  }

  fabButton.addEventListener('click', () => {
    window.location.href = 'cleanlog.html';
  });

  fabButton.addEventListener('keydown', (e) => {
    if(e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      fabButton.click();
    }
  });

  renderPendingTrades();

  // --------- Ø³Ø­Ø¨ Ø§Ù„Ø²Ø± Ø§Ù„Ø¹Ø§Ø¦Ù… Ù…Ø¹ Ø­ÙØ¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ----------
  let isDragging = false;
  let offsetX, offsetY;

  const savedPosition = JSON.parse(localStorage.getItem('fabPosition'));
  if (savedPosition) {
    fabButton.style.bottom = 'unset';
    fabButton.style.right = 'unset';
    fabButton.style.top = savedPosition.top;
    fabButton.style.left = savedPosition.left;
  }

  function startDrag(e) {
    isDragging = true;
    const rect = fabButton.getBoundingClientRect();
    offsetX = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
    offsetY = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;

    document.addEventListener('mousemove', drag);
    document.addEventListener('mouseup', stopDrag);
    document.addEventListener('touchmove', drag, { passive: false });
    document.addEventListener('touchend', stopDrag);
  }

  function drag(e) {
    if (!isDragging) return;
    e.preventDefault();

    const x = (e.touches ? e.touches[0].clientX : e.clientX) - offsetX;
    const y = (e.touches ? e.touches[0].clientY : e.clientY) - offsetY;

    fabButton.style.left = x + 'px';
    fabButton.style.top = y + 'px';
    fabButton.style.bottom = 'unset';
    fabButton.style.right = 'unset';
  }

  function stopDrag() {
    isDragging = false;
    localStorage.setItem('fabPosition', JSON.stringify({
      top: fabButton.style.top,
      left: fabButton.style.left
    }));

    document.removeEventListener('mousemove', drag);
    document.removeEventListener('mouseup', stopDrag);
    document.removeEventListener('touchmove', drag);
    document.removeEventListener('touchend', stopDrag);
  }

  fabButton.addEventListener('mousedown', startDrag);
  fabButton.addEventListener('touchstart', startDrag, { passive: false });
</script></body>
</html>