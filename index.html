<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>إضافة الصفقات</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      direction: rtl;
      background: #202124;
      color: #e8eaed;
    }

    .container {
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }

    h2 {
      color: #fbbc04;
      text-align: center;
      margin-bottom: 20px;
    }

    form {
      background: #303134;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.4);
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border-radius: 6px;
      border: 1px solid #5f6368;
      background: #202124;
      color: #e8eaed;
      font-size: 16px;
    }

    input:focus, select:focus {
      border-color: #fbbc04;
      outline: none;
    }

    .checkbox-container {
      display: flex;
      align-items: center;
      margin-top: 15px;
    }

    .checkbox-container input {
      margin-left: 10px;
    }

    button {
      margin-top: 20px;
      width: 100%;
      padding: 12px;
      font-size: 16px;
      background: #fbbc04;
      border: none;
      border-radius: 8px;
      color: #202124;
      font-weight: bold;
      cursor: pointer;
    }

    button:disabled {
      background: #5f6368;
      color: #9aa0a6;
      cursor: not-allowed;
    }

    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 0;
      right: -250px;
      width: 250px;
      height: 100%;
      background-color: #303134;
      box-shadow: -3px 0 8px rgba(0,0,0,0.4);
      padding-top: 60px;
      transition: right 0.3s ease;
      z-index: 1001;
    }

    .sidebar.open {
      right: 0;
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
      text-align: center;
    }

    .sidebar li {
      padding: 20px 0;
      font-size: 18px;
      border-bottom: 1px solid #5f6368;
      cursor: pointer;
    }

    .sidebar li:hover {
      background-color: #444;
    }

    /* Sidebar trigger */
    #menuIcon {
      position: fixed;
      top: 15px;
      right: 15px;
      font-size: 30px;
      background: #fbbc04;
      color: #202124;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      z-index: 1002;
    }

    /* Overlay */
    .overlay {
      position: fixed;
      top: 0; right: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 1000;
    }

    .overlay.show {
      display: block;
    }
  </style>
</head>
<body>

<div id="menuIcon">&#9776;</div>

<div class="overlay" id="overlay"></div>

<div class="sidebar" id="sidebar">
  <ul>
    <li onclick="goToLog()">📋 سجل الصفقات</li>
  </ul>
</div>

<div class="container">
  <h2>إضافة الصفقات</h2>
  <form id="tradeForm">
    <label for="pair">زوج التداول:</label>
    <select id="pair" required>
      <option value="EUR/USD">EUR/USD</option>
      <option value="XAU/USD">XAU/USD</option>
      <option value="BTC/USD">BTC/USD</option>
      <option value="USD/JPY">USD/JPY</option>
    </select>

    <label for="type">نوع الصفقة:</label>
    <select id="type" required>
      <option value="شراء">شراء</option>
      <option value="بيع">بيع</option>
    </select>

    <label for="entry">سعر الدخول:</label>
    <input type="number" id="entry" step="0.0001" required />

    <label for="sl">وقف الخسارة:</label>
    <input type="number" id="sl" step="0.0001" required />

    <label for="tp">الهدف:</label>
    <input type="number" id="tp" step="0.0001" required />

    <label for="image">إرفاق صورة (اختياري):</label>
    <input type="file" id="image" accept="image/*" />

    <div class="checkbox-container">
      <input type="checkbox" id="conditionsCheck" />
      <label for="conditionsCheck">تم توفر جميع الشروط</label>
    </div>

    <button type="submit" id="addTradeBtn" disabled>إضافة الصفقة مؤقتًا</button>
  </form>
</div>

<script>
  let pendingTrades = JSON.parse(sessionStorage.getItem('pendingTrades') || '[]');
  let savedTrades = JSON.parse(localStorage.getItem('trades') || '[]');

  const form = document.getElementById('tradeForm');
  const addTradeBtn = document.getElementById('addTradeBtn');
  const checkbox = document.getElementById('conditionsCheck');

  checkbox.addEventListener('change', () => {
    addTradeBtn.disabled = !checkbox.checked;
  });

  form.addEventListener('submit', e => {
    e.preventDefault();
    const fileInput = document.getElementById('image');
    const file = fileInput.files[0];

    const trade = {
      pair: form.pair.value,
      type: form.type.value,
      entry: form.entry.value,
      sl: form.sl.value,
      tp: form.tp.value,
      timestamp: new Date().toISOString(),
      result: 'جارية',
      image: null
    };

    if (file) {
      const reader = new FileReader();
      reader.onload = () => {
        trade.image = reader.result;
        saveTrade(trade);
      };
      reader.readAsDataURL(file);
    } else {
      saveTrade(trade);
    }
  });

  function saveTrade(trade) {
    pendingTrades.push(trade);
    sessionStorage.setItem('pendingTrades', JSON.stringify(pendingTrades));
    alert("تمت إضافة الصفقة مؤقتًا.");
    form.reset();
    addTradeBtn.disabled = true;
    checkbox.checked = false;
  }

  // القائمة الجانبية
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('overlay');
  const menuIcon = document.getElementById('menuIcon');

  menuIcon.onclick = () => {
    sidebar.classList.add('open');
    overlay.classList.add('show');
  };

  overlay.onclick = () => {
    sidebar.classList.remove('open');
    overlay.classList.remove('show');
  };

  function goToLog() {
    window.location.href = 'cleanlog.html';
  }
</script>

</body>
</html>