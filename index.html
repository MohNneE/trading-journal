// تحميل الصفقات من التخزين عند بدء الصفحة
window.onload = function() {
  loadTradesFromStorage();
};

function saveTrade() {
  // ... الكود القديم ...
  
  // حفظ في localStorage
  saveTradeToStorage({
    pair, type, entry, sl, tp,
    result: "جارية",
    conditionsMet: true,
    timestamp: new Date().toISOString()
  });

  // ... الكود القديم ...
}

function saveTradeToStorage(trade) {
  let trades = JSON.parse(localStorage.getItem("trades") || "[]");
  trades.push(trade);
  localStorage.setItem("trades", JSON.stringify(trades));
}

function loadTradesFromStorage() {
  let trades = JSON.parse(localStorage.getItem("trades") || "[]");
  trades.forEach(trade => addTradeToTable(trade));
}

function addTradeToTable(trade) {
  tradeCount++;

  const table = document.getElementById("tradesTable").querySelector("tbody");
  const row = document.createElement("tr");

  const resultCell = document.createElement("td");
  const resultSelect = document.createElement("select");
  resultSelect.innerHTML = `
    <option value="جارية" ${trade.result === "جارية" ? "selected" : ""}>🔄 جارية</option>
    <option value="ربح" ${trade.result === "ربح" ? "selected" : ""}>✅ ربح</option>
    <option value="خسارة" ${trade.result === "خسارة" ? "selected" : ""}>❌ خسارة</option>
  `;
  // عند تغيير النتيجة نحدث التخزين أيضاً
  resultSelect.addEventListener("change", function() {
    updateTradeResult(trade.timestamp, this.value);
  });
  resultCell.appendChild(resultSelect);

  row.innerHTML = `
    <td data-label="#">${tradeCount}</td>
    <td data-label="الزوج">${trade.pair}</td>
    <td data-label="النوع">${trade.type}</td>
    <td data-label="دخول">${trade.entry}</td>
    <td data-label="وقف">${trade.sl}</td>
    <td data-label="هدف">${trade.tp}</td>
  `;
  row.appendChild(resultCell);
  row.innerHTML += `<td data-label="الشروط">✅</td>`;

  table.appendChild(row);
}

function updateTradeResult(timestamp, newResult) {
  let trades = JSON.parse(localStorage.getItem("trades") || "[]");
  let index = trades.findIndex(t => t.timestamp === timestamp);
  if (index !== -1) {
    trades[index].result = newResult;
    localStorage.setItem("trades", JSON.stringify(trades));
  }
}
